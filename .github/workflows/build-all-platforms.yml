name: Build Windows Folder (onedir)

on:
  workflow_dispatch:          # только ручной запуск, чтобы не собиралось при каждом коммите

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pyinstaller
          # Если в коде используются асинхронные библиотеки — раскомментируй/добавь:
          # pip install aiohttp aiofiles

      - name: Build as folder (no --onefile)
        run: |
          pyinstaller `
            --name AsyncDomenParser `
            --add-data "day.txt;." `
            --add-data "links.txt;." `
            --add-data "webhook.txt;." `
            --add-data "thread_1.txt;." `
            --add-data "thread_2.txt;." `
            --add-data "thread_3.txt;." `
            --add-data "thread_4.txt;." `
            --add-data "thread_5.txt;." `
            --add-data "thread_6.txt;." `
            --add-data "thread_7.txt;." `
            --add-data "thread_8.txt;." `
            --add-data "thread_9.txt;." `
            --add-data "thread_10.txt;." `
            main.py

      - name: Upload the entire folder as artifact
        uses: actions/upload-artifact@v4
        with:
          name: AsyncDomenParser-windows-folder
          path: dist/AsyncDomenParser/**
          if-no-files-found: error
